package com.socar.hrsocar.parser;
import java.io.IOException;
import java.io.StringReader;
import java.util.ArrayList;
import java.util.List;

import javax.xml.parsers.ParserConfigurationException;
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;

import org.xml.sax.Attributes;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;
import org.xml.sax.helpers.DefaultHandler;

import com.socar.hrsocar.model.MltrItem;
public class MilitaryParser extends DefaultHandler{
	private MltrItem mltrItem;
	List<MltrItem> mltrItemList= new ArrayList<MltrItem>();
	protected StringBuilder seriesSb;
	protected StringBuilder idNumberSb;
	protected StringBuilder issueDateSb;
	protected StringBuilder expiryDateSb;
	protected StringBuilder fitSb;
	protected StringBuilder groupSb;
	protected StringBuilder categorySb;
	protected StringBuilder staffSb;
	protected StringBuilder rankSb;
	boolean newMltrItemFlag=true;
	private String inputXml;
	
	public MilitaryParser(String inputXml) {
		super();
		this.inputXml = inputXml; 
	}
	
	public List<MltrItem> getResult(){
		try {
			SAXParserFactory saxParserFactory = SAXParserFactory.newInstance(); 
			SAXParser saxParser = saxParserFactory.newSAXParser();
			DefaultHandler defaultHandler = new DefaultHandler(){
			String mltrItemTag="close";  
		    String seriesTag="close";
		    String idNumberTag="close";  
		    String expiryDateTag="close";
		    String issueDateTag="close";
		    String fitTag="close";
		    String groupTag="close";
		    String staffTag="close";
		    String categoryTag="close";
		    String rankTag="close";
		    public void startElement(String uri, String localName, String tagName,Attributes attributes) throws SAXException {  
		    	if (tagName.equalsIgnoreCase("item")) {  
		    		mltrItemTag = "open";
			    } 
		    	if (tagName.equalsIgnoreCase("series")) {  
		    		seriesTag = "open";
		    		seriesSb=new StringBuilder();
			    }  
		    	
		    	if (tagName.equalsIgnoreCase("idNumber")) {  
		    		idNumberTag = "open";
		    		idNumberSb=new StringBuilder();
			    }
		    	if (tagName.equalsIgnoreCase("issueDate")) {  
		    		issueDateTag = "open";
		    		issueDateSb=new StringBuilder();
			    }  
		    	if (tagName.equalsIgnoreCase("ExpiryDate")) {  
		    		expiryDateTag = "open";  
		    		expiryDateSb=new StringBuilder();
			    }
		    } 	
		    public void characters(char ch[], int start, int length)throws SAXException { 
		    	if (mltrItemTag.equals("open")) {  
		    		if(newMltrItemFlag){
			    		 mltrItem = new MltrItem();
			    		 newMltrItemFlag=false;
			    	 }
			    }
		    	if (seriesTag.equals("open")) {  
				 	 if (seriesSb!=null) {
				 	        for (int i=start; i<start+length; i++) {
				   	            seriesSb.append(ch[i]);
				    	    }
				   	    }
			     }
		    	if (idNumberTag.equals("open")) {  
				 	 if (idNumberSb!=null) {
				 	        for (int i=start; i<start+length; i++) {
				   	            idNumberSb.append(ch[i]);
				    	    }
				   	    }
			     }
		    	if (issueDateTag.equals("open")) {  
				 	 if (issueDateSb!=null) {
				 	        for (int i=start; i<start+length; i++) {
				 	        	issueDateSb.append(ch[i]);
				    	    }
				   	    }
			     }
		    	if (expiryDateTag.equals("open")) {  
				 	 if (expiryDateSb!=null) {
				 	        for (int i=start; i<start+length; i++) {
				 	        	expiryDateSb.append(ch[i]);
				    	    }
				   	    }
			     }
		    }  
		    
		    public void endElement(String uri, String localName, String tagName)  
		    	throws SAXException {  
				   	if (tagName.equalsIgnoreCase("item")) {  
				   		mltrItemTag = "close";    
					    newMltrItemFlag=true;
					    mltrItemList.add(mltrItem);
				   	}  
				   	if (tagName.equalsIgnoreCase("series")) {  
				   		seriesTag = "close"; 
				   		mltrItem.setSeries(seriesSb.toString().trim());
				   	}
				   	if (tagName.equalsIgnoreCase("idNumber")) {  
				   		idNumberTag = "close";  
				   		mltrItem.setIdNumber(idNumberSb.toString().trim());
				   	}
				   	if (tagName.equalsIgnoreCase("issueDate")) {  
				   		issueDateTag = "close";
				   		mltrItem.setIssueDate(issueDateSb.toString().trim());
				   	}
				   	
				   	if (tagName.equalsIgnoreCase("ExpiryDate")) {  
				   		expiryDateTag = "close";
				   		mltrItem.setExpiryDate(expiryDateSb.toString().trim());
				   	}
				   	

		    	}  
			};
			try {
				saxParser.parse(new InputSource(new StringReader(inputXml)), defaultHandler);
			} catch (IOException e) {
				e.printStackTrace();
			}
		} catch (ParserConfigurationException e) {
			e.printStackTrace();
		} catch (SAXException e) {
			e.printStackTrace();
		}  
	return mltrItemList;
}

}
